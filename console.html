<!doctype html>
<html>
<head>
<link rel="stylesheet" href="lisp_styling.css">
</head>
<body>
<div id="console_area">
 i i i i i i i
 I I I I I I I
 I  \ `+´ /  I
  \  `-+-´  /
   `-__|__-´
       |
 ------+------
</div>
<div id="console_input_line">
<div id="console_prompt"></div>
<input id="console_input"></input>
</div>
<script>
var command_log = (function () {
		var cmd_log = [],
			cmd_key = 0,
			cmd_num = 0,
			cmd_cache = "",
			add_cmd = function (cmd) {
				cmd_log.push(cmd);
				cmd_key = cmd_log.length;
				cmd_cache = "";
				return cmd;
			},
			cache_cmd = function (cmd) {
				cmd_cache = cmd;
				return cmd;
			},
			get_curr_prompt_num = function () {
				return cmd_num;
			},
			get_next_prompt_num = function () {
				cmd_num += 1;
				return cmd_num;
			},
			get_prev_cmd = function () {
				cmd_key -= (cmd_key) ? 1 : 0;
				return cmd_log[cmd_key];
			},
			get_next_cmd = function () {
				cmd_key += (cmd_key < cmd_log.length) ? 1 : 0;
				return (cmd_key < cmd_log.length) ? cmd_log[cmd_key] : cmd_cache;
			};
		return {
			add_cmd: add_cmd,
			cache_cmd: cache_cmd,
			get_curr_prompt_num: get_curr_prompt_num,
			get_next_prompt_num: get_next_prompt_num,
			get_prev_cmd: get_prev_cmd,
			get_next_cmd: get_next_cmd
		};
	})(),

	process_input = function (input) {
		var rtn,
			arr = separate_terms(input),
			rst;
		
		while (arr.length) {
			update_console("input-" + command_log.get_curr_prompt_num(), "[" + command_log.get_curr_prompt_num() + "]> " + input);
			input = "";
			rst = evaluate_term(arr.shift());
			update_console("result-" + command_log.get_curr_prompt_num(), rst);
			prompt_set("[" + command_log.get_next_prompt_num() + "]> ");
		}
		
		return rtn;
	},

	update_console = function (id, value) {
		// TODO: optimise
		document.getElementById("console_area").innerHTML += "<div id='" + id + "' class='console_line'>" + value + "</div>";
	},

	add_input_to_console = function (value) {
		// TODO: complete
	}

	add_result_to_console = function (value) {
		// TODO: complete
	}

	prompt_set = function (value) {
		document.getElementById("console_prompt").innerHTML = value;
	}

	input_get = function () {
		return document.getElementById("console_input").value;
	},

	input_set = function (value) {
		document.getElementById("console_input").value = value;
	};

window.onload = function () {

	var interpreter = document.createElement("script");
	interpreter.src = "lisp_interpreter.js";
	document.getElementsByTagName("script")[0].appendChild(interpreter);
		
	prompt_set("[" + command_log.get_next_prompt_num() + "]> ");
	document.getElementById("console_input").focus();
	document.getElementById("console_input").onkeyup = function (k) {
		var e = k || window.event,
			input = input_get(); // for IE8
		if (e.keyCode === 13) {
			input_set("");
			command_log.add_cmd(input);
			process_input(input);
		} else if (e.keyCode === 38) {
			// up
			input_set(command_log.get_prev_cmd() || "");
		} else if (e.keyCode === 40) {
			// down
			input_set(command_log.get_next_cmd() || "");
		} else {
			command_log.cache_cmd(input);
		}
	};
};
</script>
</body>
</head>
</html>